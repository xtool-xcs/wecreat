import{_ as j,a as D}from"./materialListContent.vue_vue_type_style_index_0_lang-51e5ddc8.js";import"./opencv-49a7e8f2.js";import{h as M}from"./_commonjs-dynamic-modules-df5d654f.js";import{g as L}from"./getElementPX-5c89db0f.js";import{d as R,r as o,h as z,i as A,c as d,j as g,b as h,t as N,F as U,f as X,k as G,u as b,l as K,m as Q,a as W,o as v,_ as Y}from"./index-e43f4e63.js";import"./bottomPopSheet.vue_vue_type_style_index_0_lang-1c011284.js";import"./user-a7205a05.js";import"./function-call-76f75aad.js";import"./isObject-93378927.js";const Z={class:"search-area"},ee={key:0,class:"search-history"},te={class:"flex-j_c-s_b flex-a_i-c"},se={class:"history-title"},ae={class:"history-tags"},oe=["onClick"],ne=R({__name:"index",setup(ie){const p=Q(),w=window.innerHeight,y=o(),i=o([]),a=o(""),r=o(!1),l=o([]),m=o(!1),c=o(!1);let n={endCursor:"",hasNextPage:!0,hasPreviousPage:!1,startCursor:""};const T=()=>{p.back()},V=()=>{},$=()=>{_()},C=()=>{i.value=k.get()},_=()=>{m.value=!0,l.value=[],n={endCursor:"",hasNextPage:!0,hasPreviousPage:!1,startCursor:""},k.set(),x(),r.value=!1,C()},k={get:()=>{const e=localStorage.getItem("historyTags");return e?JSON.parse(e):[]},set:()=>{const e=localStorage.getItem("historyTags");let t=e?JSON.parse(e):[];a.value&&t.unshift(a.value),t=[...new Set(t)],t&&t.length>10&&(t=t.slice(0,10)),localStorage.setItem("historyTags",JSON.stringify(t))}},x=async()=>{const{pageInfo:e,products:t}=await M({limit:10,query:a.value?a.value+"*":"",cursor:n.endCursor});n=e,m.value=!1,c.value=!1;const u=t.map(s=>{var I;const f=s.node.id.split("/"),E=f[f.length-1],H=((I=s.node.variants.nodes)==null?void 0:I[0].id).split("/"),O=H[H.length-1];return{image:s.node.featuredImage.url,tags:s.node.tags,title:s.node.title,id:E,shopId:O,amount:s.node.priceRangeV2.maxVariantPrice.amount,showJoin:!1}});l.value=[...l.value,...u]},q=e=>{a.value=e,_()},B=()=>{!n.hasNextPage||c.value||(c.value=!0,x())},F=()=>{const e=L(document.body).height;y.value=e-L(document.querySelector(".search-area")).height},S=()=>{const e=document.querySelector("input");e&&e.focus(),r.value=!0},J=()=>{localStorage.removeItem("historyTags"),i.value=[]};return z(()=>{const{forward:e,back:t}=p.options.history.state;t==="/"&&!e&&(l.value=[],a.value="",n={endCursor:"",hasNextPage:!0,hasPreviousPage:!1,startCursor:""},S())}),A(()=>{F(),C(),S()}),(e,t)=>{const u=W("vk-icon");return v(),d("div",{class:"mobile-search-page",style:K({minHeight:"".concat(b(w),"px")})},[g("div",Z,[h(u,{icon:"",class:"back-icon",onClick:T}),h(j,{value:a.value,"onUpdate:value":t[0]||(t[0]=s=>a.value=s),onHandleSearch:_,onHandleClick:V,onClear:$,onFocus:t[1]||(t[1]=s=>r.value=!0)},null,8,["value"])]),r.value&&i.value&&i.value.length>0?(v(),d("div",ee,[g("div",te,[g("span",se,N(e.$t("home.searchHistory")),1),h(u,{icon:"",class:"delete-icon",onClick:J})]),g("div",ae,[(v(!0),d(U,null,X(i.value,(s,P)=>(v(),d("span",{key:P,class:"tags-item",onClick:f=>q(s)},N(s),9,oe))),128))])])):G("",!0),h(D,{"material-list":l.value,loading:m.value,height:y.value,"finished-loading":!b(n).hasNextPage,"is-scroll-loading":c.value,onScrollLoad:B},null,8,["material-list","loading","height","finished-loading","is-scroll-loading"])],4)}}});const fe=Y(ne,[["__scopeId","data-v-afd8f31a"]]);export{fe as default};
